<%- include('partials/header') %>

<div class="container mt-4">
    <h1>People</h1>
    <ul class="nav nav-tabs" id="peopleTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="members-tab" data-bs-toggle="tab" data-bs-target="#members" type="button" role="tab" aria-controls="members" aria-selected="true">Members</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="visitors-tab" data-bs-toggle="tab" data-bs-target="#visitors" type="button" role="tab" aria-controls="visitors" aria-selected="false">Visitors</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button" role="tab" aria-controls="users" aria-selected="false">Users</button>
        </li>
    </ul>
    <div class="tab-content" id="peopleTabContent">
        <div class="tab-pane fade show active" id="members" role="tabpanel" aria-labelledby="members-tab">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h1>Church Members</h1>
                <div>
                    <a href="/members/upload" class="btn btn-success">Upload Sheet</a>
                    <a href="/members/add" class="btn btn-primary">Add New Member</a>
                </div>
            </div>

            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Picture</th>
                        <th>Last Name</th>
                        <th>First Name</th>
                        <th>Phone Number</th>
                        <th>Email</th>
                        <th>Member Since</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% members.forEach(member => { %>
                        <tr>
                            <td>
                                <% if (member.picture) { %>
                                    <img src="/<%= member.picture %>" alt="Photo of <%= member.firstName %>" style="width: 50px; height: 50px; object-fit: cover; border-radius: 50%;">
                                <% } else { %>
                                    <div style="width: 50px; height: 50px; background-color: #ccc; border-radius: 50%;"></div>
                                <% } %>
                            </td>
                            <td><%= member.lastName %></td>
                            <td><%= member.firstName %></td>
                            <td><%= member.phoneNumber %></td>
                            <td><%= member.email %></td>
                            <td><%= new Date(member.memberSince).toLocaleDateString() %></td>
                            <td>
                                <a href="/members/edit/<%= member._id %>" class="btn btn-sm btn-outline-primary">Edit</a>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
        <div class="tab-pane fade" id="visitors" role="tabpanel" aria-labelledby="visitors-tab">
            <h2>Visitors List</h2>
            <p>This is a list of all visitors who are not yet members.</p>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone Number</th>
                        <th>Email</th>
                        <th>Status</th>
                        <th>First Visit</th>
                    </tr>
                </thead>
                <tbody>
                    <% visitors.forEach(visitor => { %>
                        <tr>
                            <td><%= visitor.firstName %> <%= visitor.lastName %></td>
                            <td><%= visitor.phoneNumber %></td>
                            <td><%= visitor.email %></td>
                            <td><%= visitor.status %></td>
                            <td><%= new Date(visitor.firstVisit).toLocaleDateString() %></td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
        <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="users-tab">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Linked Member</th>
                    </tr>
                </thead>
                <tbody>
                    <% users.forEach(user => { %>
                        <tr>
                            <td><%= user.username %></td>
                            <td>
                                <% if (user.member) { %>
                                    <%= user.member.firstName %> <%= user.member.lastName %>
                                <% } else { %>
                                    No member linked
                                <% } %>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
</div>

<%- include('partials/footer') %>
